<!DOCTYPE html>
<html>

<head>
    <title>MetaMask Test Page</title>
    <script src="https://unpkg.com/axios@1.1.2/dist/axios.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <!-- <script src="https://unpkg.com/@squirrel-labs/peanut-sdk-ethersv5@0.0.38/index.js" crossorigin="anonymous" type="module"></script> -->
    <!-- <script src="https://unpkg.com/@squirrel-labs/peanut-sdk-ethersv5@0.0.41/dist/peanut-sdk.js" crossorigin="anonymous" type="module"></script> -->
    <!-- for dev purposes. load peanut-sdk from ../../dist/peanut-sdk.js -->
    <!-- <script src="../../dist/peanut-sdk.js" crossorigin="anonymous"></script> -->
    <!-- <script src="https://cdn.jsdelivr.net/npm/@squirrel-labs/peanut-sdk-ethersv5/index.js" type="module"></script> -->
    <script src="https://cdn.jsdelivr.net/npm/@squirrel-labs/peanut-sdk-ethersv5/dist/peanut-sdk.js"></script>
    <!-- <script src="../../index.js" crossorigin="anonymous" type="module"></script> -->
    <!-- <script src="dist/peanut-sdk.js" crossorigin="anonymous"></script> -->
    <script>
        // console log all the imports
        console.log(peanut);
        console.log(ethers);
    </script>
</head>

<body>
    <button id="connect">Connect Wallet</button>
    <button id="getPeanutVersion">Get Peanut Version</button>
    <button id="getEthersVersion">Get Ethers Version</button>
    <button id="createLink">Create Link</button>
    <button id="getLinkStatus">Get Link Status</button>
    <button id="claimLink">Claim Link</button>
    <button id="claimLinkGasless">Claim Link Gasless</button>


    <script>
        let wallet;
        let provider;
        let link;

            document.getElementById('connect').addEventListener('click', async () => {
            if (!window.ethereum) {
                alert('MetaMask is not installed!');
                return;
            }
            const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
            provider = new ethers.providers.Web3Provider(window.ethereum);
            wallet = provider.getSigner(accounts[0]);
        });

        document.getElementById('getPeanutVersion').addEventListener('click', async () => {
            console.log(peanut.version);
        });

        document.getElementById('getEthersVersion').addEventListener('click', () => {
            console.log(ethers.version);
        });

        document.getElementById('createLink').addEventListener('click', async () => {
            const { link: newLink, txReceipt } = await peanut.createLink({
                signer: wallet,
                chainId: 420,
                tokenAmount: 0.0001337,
                tokenType: 0,
                verbose: true,
            });
            link = newLink;
        });

        document.getElementById('getLinkStatus').addEventListener('click', async () => {
            let link = 'https://peanut.to/claim?c=137&v=v4&i=114&p=EAlYhwYt2VteSusd&t=campaignId?'
            const status = (await peanut.getLinkStatus({ signer: wallet, link: link })).claimed;
            console.log(status);
        });

        document.getElementById('claimLink').addEventListener('click', async () => {
            const claimTx = await peanut.claimLink({ signer: wallet, link: link });
            console.log("claimTx: ", claimTx.hash);
            const status = (await peanut.getLinkStatus({ signer: wallet, link: link })).claimed;
            console.log(status);
        });

    document.getElementById('claimLinkGasless').addEventListener('click', async () => {
        //'https://peanut.to/claim?c=137&v=v4&i=112&p=jms2zuPc275MIFqD&t=campaignId?',
        //'https://peanut.to/claim?c=137&v=v4&i=113&p=WDHHonJybxqewpqE&t=campaignId?',
        //'https://peanut.to/claim?c=137&v=v4&i=114&p=EAlYhwYt2VteSusd&t=campaignId?'

        let sampleLink = 'https://peanut.to/claim?c=137&v=v4&i=112&p=jms2zuPc275MIFqD&t=campaignId?'
        console.log('claiming link....')
        const response = await peanut.claimLinkGasless(sampleLink, "0x6B3751c5b04Aa818EA90115AA06a4D9A36A16f02", "gvAMxXbG8n177xrH4mc0PfzuhcJumFC5");
        console.log("response: ", response);
        //const status = (await peanut.getLinkStatus({ signer: wallet, link: link })).claimed;
        //console.log(status);
    });
    </script>
</body>

</html>